{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 450,
  "title": "Fire Incidents by Australian State/Territory (2016-2021)",
  "projection": { "type": "equalEarth" },
  "layer": [
    {
      "data": {
        "url": "STE_2021_AUST_GDA2020.topojson",
        "format": { "type": "topojson", "feature": "STE_2021_AUST_GDA2020" }
      },
      "mark": { "type": "geoshape", "fill": "lightgray", "stroke": "white" }
    },
    {
      "data": {
        "url": "data/Fire_For16-21_Attributes.csv"
      },
      "transform": [
        {
          "filter": "datum.STATE != '' &&  datum.STATE != null"
        },
        {
          "filter": "datum.FOR_CATEGO == 'Native forest'"
        },
        {
          "fold": [
            "FIRE_1617",
            "FIRE_1718",
            "FIRE_1819",
            "FIRE_1920",
            "FIRE_2021"
          ],
          "as": ["Year", "FireCount"]
        },
        {
          "calculate": "datum.Year == 'FIRE_1617' ? '2016-17' : datum.Year == 'FIRE_1718' ? '2017-18' : datum.Year == 'FIRE_1819' ? '2018-19' : datum.Year == 'FIRE_1920' ? '2019-20' : '2020-21'",
          "as": "YearLabel"
        },
        {
          "calculate": "datum.Year == 'FIRE_1617' ? 2017 : datum.Year == 'FIRE_1718' ? 2018 : datum.Year == 'FIRE_1819' ? 2019 : datum.Year == 'FIRE_1920' ? 2020 : 2021",
          "as": "YearNum"
        },
        {
          "calculate": "datum.FireCount == 'U' || datum.FireCount == 'P' ? 1 : 0",
          "as": "HasFire"
        },
        {
          "filter": "datum.HasFire == 1"
        },
        {
          "aggregate": [
            { "op": "sum", "field": "HasFire", "as": "FireIncidents" }
          ],
          "groupby": ["STATE"]
        }
      ],
      "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.5 },
      "encoding": {
        "color": {
          "field": "total_fires",
          "type": "quantitative",
          "title": "Total Fire Incidents",
          "scale": { "scheme": "orangered" }
        },
        "tooltip": [
          {
            "field": "properties.STE_NAME21",
            "type": "nominal",
            "title": "State/Territory"
          },
          {
            "field": "total_fires",
            "type": "quantitative",
            "title": "Total Fire Incidents"
          },
          {
            "field": "unplanned_fires",
            "type": "quantitative",
            "title": "Unplanned Fires"
          },
          {
            "field": "planned_fires",
            "type": "quantitative",
            "title": "Planned Fires"
          }
        ]
      }
    }
  ]
}
