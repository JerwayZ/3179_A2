{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 450,
  "title": "Fire Incidents by Australian State/Territory (2016-2021)",
  "projection": { "type": "equirectangular" },
  "params": [
    {
      "name": "yearFilter",
      "value": null,
      "bind": {
        "input": "select",
        "options": [null, 2017, 2018, 2019, 2020, 2021],
        "labels": ["All Years", "2017", "2018", "2019", "2020", "2021"],
        "name": "Select Year: "
      }
    }
  ],
  "data": {
    "url": "data/Fire_For16-21_Attributes.csv"
  },
  "transform": [
    {
      "filter": "datum.FOR_CATEGO == 'Native forest' && datum.STATE != '' && datum.STATE != null"
    },
    {
      "fold": [
        "FIRE_1617",
        "FIRE_1718",
        "FIRE_1819", 
        "FIRE_1920",
        "FIRE_2021"
      ],
      "as": ["YearColumn", "FireStatus"]
    },
    {
      "calculate": "datum.YearColumn == 'FIRE_1617' ? 2017 : datum.YearColumn == 'FIRE_1718' ? 2018 : datum.YearColumn == 'FIRE_1819' ? 2019 : datum.YearColumn == 'FIRE_1920' ? 2020 : 2021",
      "as": "Year"
    },
    {
      "filter": "yearFilter == null || datum.Year == yearFilter"
    },
    {
      "filter": "datum.FireStatus == 'U' || datum.FireStatus == 'P'"
    },
    {
      "calculate": "datum.FireStatus == 'U' ? 1 : 0",
      "as": "IsUnplanned"
    },
    {
      "calculate": "datum.FireStatus == 'P' ? 1 : 0",
      "as": "IsPlanned"
    },
    {
      "aggregate": [
        { "op": "sum", "field": "IsUnplanned", "as": "UnplannedFires" },
        { "op": "sum", "field": "IsPlanned", "as": "PlannedFires" },
        { "op": "count", "as": "FireIncidents" }
      ],
      "groupby": ["STATE"]
    },
    {
      "calculate": "datum.STATE == 'NSW' ? '1' : datum.STATE == 'Vic' ? '2' : datum.STATE == 'Qld' ? '3' : datum.STATE == 'SA' ? '4' : datum.STATE == 'WA' ? '5' : datum.STATE == 'Tas' ? '6' : datum.STATE == 'NT' ? '7' : datum.STATE == 'ACT' ? '8' : datum.STATE",
      "as": "StateCode"
    },
    {
      "lookup": "StateCode",
      "from": {
        "data": {
          "url": "STE_2021_AUST_GDA2020.topojson",
          "format": { "type": "topojson", "feature": "STE_2021_AUST_GDA2020" }
        },
        "key": "properties.STE_CODE21"
      },
      "as": "geo"
    }
  ],
  "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.5 },
  "encoding": {
    "shape": { "field": "geo", "type": "geojson" },
    "color": {
      "field": "FireIncidents",
      "type": "quantitative",
      "title": "Total Fire Incidents",
      "scale": { "scheme": "orangered" }
    },
    "tooltip": [
      {
        "field": "geo.properties.STE_NAME21",
        "type": "nominal",
        "title": "State/Territory"
      },
      {
        "field": "FireIncidents",
        "type": "quantitative",
        "title": "Total Fire Incidents"
      },
      {
        "field": "UnplannedFires",
        "type": "quantitative",
        "title": "Unplanned Fires"
      },
      {
        "field": "PlannedFires",
        "type": "quantitative",
        "title": "Planned Fires"
      }
    ]
  }
}