{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Average Rainfall by State/Territory",
    "fontSize": 16,
    "anchor": "start"
  },
  "width": 600,
  "height": 400,
  "data": {
    "url": "data/Weather Test Data.csv"
  },
  "params": [
    {
      "name": "state_selection",
      "select": {
        "type": "point",
        "fields": ["State"]
      },
      "bind": "legend"
    }
  ],
  "transform": [
    {
      "filter": "datum.Location != '' && datum.Location != null"
    },
    {
      "filter": "datum.Rainfall != '' && datum.Rainfall != null"
    },
    {
      "calculate": "datum.Location == 'Albury' || datum.Location == 'BadgerysCreek' || datum.Location == 'Cobar' || datum.Location == 'CoffsHarbour' || datum.Location == 'Moree' || datum.Location == 'Newcastle' || datum.Location == 'NorahHead' || datum.Location == 'Penrith' || datum.Location == 'Richmond' || datum.Location == 'Sydney' || datum.Location == 'SydneyAirport' || datum.Location == 'WaggaWagga' || datum.Location == 'Williamtown' || datum.Location == 'Wollongong' ? 'NSW' : datum.Location == 'Melbourne' || datum.Location == 'MelbourneAirport' || datum.Location == 'Mildura' || datum.Location == 'MountGinini' || datum.Location == 'Nhil' || datum.Location == 'Portland' || datum.Location == 'Sale' || datum.Location == 'Watsonia' ? 'VIC' : datum.Location == 'Brisbane' || datum.Location == 'Cairns' || datum.Location == 'GoldCoast' || datum.Location == 'Townsville' ? 'QLD' : datum.Location == 'Adelaide' || datum.Location == 'MountGambier' || datum.Location == 'Nuriootpa' || datum.Location == 'Woomera' ? 'SA' : datum.Location == 'Perth' || datum.Location == 'PerthAirport' || datum.Location == 'PearceRAAF' || datum.Location == 'SalmonGums' || datum.Location == 'Walpole' || datum.Location == 'Witchcliffe' ? 'WA' : datum.Location == 'Hobart' || datum.Location == 'Launceston' ? 'TAS' : datum.Location == 'Canberra' || datum.Location == 'Tuggeranong' ? 'ACT' : datum.Location == 'Darwin' || datum.Location == 'Katherine' || datum.Location == 'Uluru' ? 'NT' : datum.Location == 'NorfolkIsland' ? 'Norfolk Island' : 'Other'",
      "as": "State"
    },
    {
      "calculate": "datum.Rainfall > 0 ? 1 : 0",
      "as": "RainDay"
    },
    {
      "aggregate": [
        {"op": "mean", "field": "Rainfall", "as": "AvgRainfall"},
        {"op": "sum", "field": "RainDay", "as": "TotalRainyDays"},
        {"op": "count", "as": "TotalDays"},
        {"op": "max", "field": "Rainfall", "as": "MaxRainfall"},
        {"op": "min", "field": "Rainfall", "as": "MinRainfall"}
      ],
      "groupby": ["State"]
    },
    {
      "calculate": "datum.TotalRainyDays / datum.TotalDays * 100",
      "as": "RainPercentage"
    }
  ],
  "mark": {
    "type": "bar",
    "opacity": 0.8,
    "stroke": "white",
    "strokeWidth": 1
  },
  "encoding": {
    "x": {
      "field": "State",
      "type": "nominal",
      "title": "State/Territory",
      "sort": ["NSW", "VIC", "QLD", "SA", "WA", "TAS", "ACT", "NT", "Norfolk Island"],
      "axis": {
        "labelAngle": -45
      }
    },
    "y": {
      "field": "AvgRainfall",
      "type": "quantitative",
      "title": "Average Daily Rainfall (mm)",
      "scale": {
        "zero": true
      }
    },
    "color": {
      "field": "State",
      "type": "nominal",
      "title": "State/Territory",
      "scale": {
        "domain": ["NSW", "VIC", "QLD", "SA", "WA", "TAS", "ACT", "NT", "Norfolk Island"],
        "range": ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22"]
      }
    },
    "opacity": {
      "condition": {
        "param": "state_selection",
        "value": 0.9
      },
      "value": 0.3
    },
    "tooltip": [
      {"field": "State", "type": "nominal", "title": "State/Territory"},
      {"field": "AvgRainfall", "type": "quantitative", "title": "Average Daily Rainfall (mm)", "format": ".2f"},
      {"field": "RainPercentage", "type": "quantitative", "title": "Rainy Days (%)", "format": ".1f"},
      {"field": "TotalRainyDays", "type": "quantitative", "title": "Total Rainy Days"},
      {"field": "TotalDays", "type": "quantitative", "title": "Total Days Recorded"},
      {"field": "MaxRainfall", "type": "quantitative", "title": "Maximum Rainfall (mm)", "format": ".1f"},
      {"field": "MinRainfall", "type": "quantitative", "title": "Minimum Rainfall (mm)", "format": ".1f"}
    ]
  },
  "config": {
    "view": {
      "stroke": null
    },
    "bar": {
      "cornerRadius": 2
    }
  }
}
